# Supabase セットアップガイド

## 概要
このガイドでは、高校生プレゼンテーションコンテスト2025特設サイトのアクセスコード管理システムをSupabaseで構築する手順を説明します。

## セットアップ手順

### 1. Supabaseダッシュボードにログイン
[Supabase Dashboard](https://app.supabase.com/project/goneyrlzzblcyzasecnl) にアクセス

### 2. SQL Editorでテーブルを作成

1. 左側メニューから「SQL Editor」を選択
2. 「New query」をクリック
3. `supabase_setup.sql`の内容をコピー＆ペースト
4. 「Run」ボタンをクリックして実行

### 3. テーブルの確認

SQL実行後、「Table Editor」で以下のテーブルが作成されていることを確認：

- **access_codes**: アクセスコード管理テーブル
- **access_logs**: アクセスログテーブル

### 4. 初期データの確認

`access_codes`テーブルに以下の初期データが登録されているはずです：
- `UEKUSA2025` (メインアクセスコード)
- `GUEST2025` (ゲスト用アクセスコード)

## ファイル構成と機能

### 📁 認証関連ファイル

1. **login.html** - ユーザー向けログインページ
   - Supabaseと連携してアクセスコードを検証
   - 有効期限のチェック機能
   - アクセスログの自動記録

2. **admin.html** - 管理者向け管理画面
   - アクセスコードの追加・編集・削除
   - アクセスログの閲覧
   - 統計情報の表示

3. **index.html** - メインサイト
   - 認証済みユーザーのみアクセス可能

## 管理画面の使い方

### 管理画面へのアクセス
1. ブラウザで`admin.html`を開く
2. 管理者パスワード: `admin2025`でログイン

### アクセスコードの管理

#### 新規コードの追加
1. 「新規コード追加」ボタンをクリック
2. コードと説明を入力
3. 必要に応じて有効期限を設定
4. 「追加」をクリック

#### コードの有効/無効切り替え
- 各コードの「有効化」「無効化」ボタンで切り替え

#### コードの削除
- 「削除」ボタンをクリック（確認ダイアログが表示されます）

### アクセスログの確認
- 直近50件のアクセスログが自動表示
- アクセス日時、使用コード、ユーザーエージェントを確認可能

## セキュリティ設定

### 重要: 本番環境での設定変更

1. **管理者パスワードの変更**
   ```javascript
   // admin.html 内
   const ADMIN_PASSWORD = 'admin2025'; // ← 強固なパスワードに変更
   ```

2. **Supabaseの環境変数設定**
   - 本番環境ではAPIキーを環境変数で管理することを推奨

3. **RLS（Row Level Security）の確認**
   - Supabaseダッシュボードで各テーブルのRLSが有効になっていることを確認

## トラブルシューティング

### エラー: "relation "access_codes" does not exist"
- SQL Editorで`supabase_setup.sql`を実行していない
- 解決: SQL Editorでテーブル作成スクリプトを実行

### エラー: "アクセスコードが正しくありません"
- コードがデータベースに存在しない
- コードが無効化されている
- 有効期限が切れている
- 解決: 管理画面でコードを確認・追加

### エラー: "Failed to fetch"
- Supabase URLまたはAPIキーが正しくない
- 解決: `login.html`と`admin.html`のSupabase設定を確認

## アクセスコードの運用例

### 推奨される運用方法

1. **メインコード** (`UEKUSA2025`)
   - 関係者全員に共有
   - 定期的に変更（月1回程度）

2. **一時コード**
   - イベント当日用に発行
   - 有効期限を設定（例: イベント終了時）

3. **ゲストコード**
   - 外部の方向けに個別発行
   - 短い有効期限を設定

### アクセスログの活用
- 不正アクセスの監視
- 利用状況の分析
- アクセスパターンの把握

## 次のステップ

### 必須設定
1. ✅ Supabaseでテーブルを作成
2. ⬜ 管理者パスワードを変更
3. ⬜ 初期アクセスコードを変更
4. ⬜ 本番環境にデプロイ

### オプション設定
- ⬜ カスタムドメインの設定
- ⬜ SSL証明書の設定
- ⬜ バックアップの設定
- ⬜ メール通知の設定

## サポート

問題が発生した場合は、以下を確認してください：

1. Supabaseのステータス: https://status.supabase.com/
2. ブラウザのコンソールでエラーメッセージを確認
3. Supabaseダッシュボードのログを確認

---

**注意**: このシステムは教育目的で作成されています。実運用環境では、より強固なセキュリティ対策を実施してください。